<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content="Vishal Koparde, Ph.D."><link rel="shortcut icon" href=../img/favicon.ico><title>mimeo - spacesavers2</title><link rel=stylesheet href=../css/theme.css><link rel=stylesheet href=../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><link href=../css/custom.css rel=stylesheet><link href=../css/version-select.css rel=stylesheet><script>
        // Current page data
        var mkdocs_page_name = "mimeo";
        var mkdocs_page_input_path = "mimeo.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=.. class="icon icon-home"> spacesavers2 </a><div role=search> <form id=rtd-search-form class=wy-form action=../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=..>Background</a> </li> </ul> <p class=caption><span class=caption-text>Usage</span></p> <ul class=current> <li class=toctree-l1><a href=../catalog/ class="reference internal">catalog</a> </li> <li class="toctree-l1 current"><a class="reference internal current" href=#>mimeo</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#inputs>Inputs</a> </li> <li class=toctree-l2><a class="reference internal" href=#outputs>Outputs</a> <ul> <li class=toctree-l3><a class="reference internal" href=#duplicates>Duplicates</a> </li> <li class=toctree-l3><a class="reference internal" href=#summaries>Summaries</a> </li> <li class=toctree-l3><a class="reference internal" href=#kronatsv-and-kronahtml>KronaTSV and KronaHTML</a> </li> <li class=toctree-l3><a class="reference internal" href=#blamematrix>Blamematrix</a> </li> </ul> </li> </ul> </li> <li class=toctree-l1><a href=../grubbers/ class="reference internal">grubbers</a> </li> <li class=toctree-l1><a href=../usurp/ class="reference internal">usurp</a> </li> <li class=toctree-l1><a href=../e2e/ class="reference internal">e2e</a> </li> <li class=toctree-l1><a href=../pdq/ class="reference internal">pdq</a> </li> <li class=toctree-l1><a href=../pdq_create_db/ class="reference internal">pdq_create_db</a> </li> <li class=toctree-l1><a href=../pdq_update_db/ class="reference internal">pdq_update_db</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=..>spacesavers2</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=.. class="icon icon-home" aria-label=Docs></a></li> <li class=breadcrumb-item>Usage</li> <li class="breadcrumb-item active">mimeo</li> <li class=wy-breadcrumbs-aside> <a href=https://github.com/CCBR/spacesavers2/edit/main/mimeo.md>Edit on CCBR/spacesavers2</a> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h2 id=spacesavers2_mimeo>spacesavers2_mimeo<a class=headerlink href=#spacesavers2_mimeo title="Permanent link">&para;</a></h2> <p>This takes in the <code>catalog</code> file generated by <code>spacesavers2_catalog</code> and processes it to:</p> <ul> <li>find duplicates</li> <li>create per-user summary reports for each user (and all users).</li> </ul> <h3 id=inputs>Inputs<a class=headerlink href=#inputs title="Permanent link">&para;</a></h3> <ul> <li><code>--catalog</code> is the output file from <code>spacesavers2_catalog</code>. Thus, <code>spacesavers2_catalog</code> needs to be run before running <code>spacesavers2_mimeo</code>.</li> <li><code>--maxdepth</code> maximum folder depth upto which reports are aggregated</li> <li><code>--outdir</code> path to the output folder</li> <li><code>--prefix</code> prefix to be added to the output file names eg. date etc.</li> <li><code>--duplicatesonly</code> only report duplicates in the <code>.files.gz</code> output files. This saves a lot of disc space. (Highly recommended!)</li> <li><code>--quota</code> defines the size of the overall file mount. (eg. 200 TB for <code>/data/CCBR</code> on BIOWULF.) OccScore is dependent on this and should be provided appropriately for accurate results.</li> </ul> <div class=highlight><pre><span></span><code>%<span class=w> </span>spacesavers2_mimeo<span class=w> </span>--help
usage:<span class=w> </span>spacesavers2_mimeo<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span>-f<span class=w> </span>CATALOG<span class=w> </span><span class=o>[</span>-d<span class=w> </span>MAXDEPTH<span class=o>]</span><span class=w> </span><span class=o>[</span>-o<span class=w> </span>OUTDIR<span class=o>]</span><span class=w> </span><span class=o>[</span>-p<span class=w> </span>PREFIX<span class=o>]</span><span class=w> </span><span class=o>[</span>-q<span class=w> </span>QUOTA<span class=o>]</span><span class=w> </span><span class=o>[</span>-z<span class=w> </span><span class=p>|</span><span class=w> </span>--duplicatesonly<span class=w> </span><span class=p>|</span><span class=w> </span>--no-duplicatesonly<span class=o>]</span><span class=w> </span><span class=o>[</span>-k<span class=w> </span><span class=p>|</span><span class=w> </span>--kronaplot<span class=w> </span><span class=p>|</span><span class=w> </span>--no-kronaplot<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span>

spacesavers2_mimeo:<span class=w> </span>find<span class=w> </span>duplicates

options:
<span class=w>  </span>-h,<span class=w> </span>--help<span class=w>            </span>show<span class=w> </span>this<span class=w> </span><span class=nb>help</span><span class=w> </span>message<span class=w> </span>and<span class=w> </span><span class=nb>exit</span>
<span class=w>  </span>-f<span class=w> </span>CATALOG,<span class=w> </span>--catalog<span class=w> </span>CATALOG
<span class=w>                        </span>spacesavers2_catalog<span class=w> </span>output<span class=w> </span>from<span class=w> </span>STDIN<span class=w> </span>or<span class=w> </span>from<span class=w> </span>catalog<span class=w> </span>file
<span class=w>  </span>-d<span class=w> </span>MAXDEPTH,<span class=w> </span>--maxdepth<span class=w> </span>MAXDEPTH
<span class=w>                        </span>folder<span class=w> </span>max.<span class=w> </span>depth<span class=w> </span>upto<span class=w> </span>which<span class=w> </span>reports<span class=w> </span>are<span class=w> </span>aggregated<span class=w> </span>...<span class=w> </span>absolute<span class=w> </span>path<span class=w> </span>is<span class=w> </span>used<span class=w> </span>to<span class=w> </span>calculate<span class=w> </span>depth<span class=w> </span><span class=o>(</span>Default:<span class=w> </span><span class=m>10</span><span class=o>)</span>
<span class=w>  </span>-o<span class=w> </span>OUTDIR,<span class=w> </span>--outdir<span class=w> </span>OUTDIR
<span class=w>                        </span>output<span class=w> </span>folder
<span class=w>  </span>-p<span class=w> </span>PREFIX,<span class=w> </span>--prefix<span class=w> </span>PREFIX
<span class=w>                        </span>prefix<span class=w> </span><span class=k>for</span><span class=w> </span>all<span class=w> </span>output<span class=w> </span>files
<span class=w>  </span>-q<span class=w> </span>QUOTA,<span class=w> </span>--quota<span class=w> </span>QUOTA
<span class=w>                        </span>total<span class=w> </span>quota<span class=w> </span>of<span class=w> </span>the<span class=w> </span>mount<span class=w> </span>eg.<span class=w> </span><span class=m>200</span><span class=w> </span>TB<span class=w> </span><span class=k>for</span><span class=w> </span>/data/CCBR
<span class=w>  </span>-z,<span class=w> </span>--duplicatesonly,<span class=w> </span>--no-duplicatesonly
<span class=w>                        </span>Print<span class=w> </span>only<span class=w> </span>duplicates<span class=w> </span>to<span class=w> </span>per<span class=w> </span>user<span class=w> </span>output<span class=w> </span>file.
<span class=w>  </span>-k,<span class=w> </span>--kronaplot,<span class=w> </span>--no-kronaplot
<span class=w>                        </span>Make<span class=w> </span>kronaplots<span class=w> </span><span class=k>for</span><span class=w> </span>duplicates.<span class=o>(</span>ktImportText<span class=w> </span>must<span class=w> </span>be<span class=w> </span><span class=k>in</span><span class=w> </span>PATH!<span class=o>)</span>
<span class=w>  </span>-v,<span class=w> </span>--version<span class=w>         </span>show<span class=w> </span>program<span class=err>&#39;</span>s<span class=w> </span>version<span class=w> </span>number<span class=w> </span>and<span class=w> </span><span class=nb>exit</span>

Version:
<span class=w>    </span>v0.10.2-dev
Example:
<span class=w>    </span>&gt;<span class=w> </span>spacesavers2_mimeo<span class=w> </span>-f<span class=w> </span>/output/from/spacesavers2_catalog<span class=w> </span>-o<span class=w> </span>/path/to/output/folder<span class=w> </span>-d<span class=w> </span><span class=m>7</span><span class=w> </span>-q<span class=w> </span><span class=m>10</span><span class=w> </span>-k
</code></pre></div> <h3 id=outputs>Outputs<a class=headerlink href=#outputs title="Permanent link">&para;</a></h3> <p>After completion of run, <code>spacesavers2_mimeo</code> creates <code>*.mimeo.files.gz</code> (list of files per user + one "allusers" file) and <code>.summary.txt</code> (overall stats at various depths) files in the provided output folder. if <code>-k</code> is provided (and ktImportText from <a href=https://github.com/marbl/Krona/wiki/KronaTools>kronatools</a> is in PATH) then krona specific TSV and HTML pages are also generated. It also generates a <code>blamematrix.tsv</code> file with folders on rows and users on columns with duplicate bytes per-folder-per-user. This file can be used to create a "heatmap" to pinpoint folder with highest duplicates overall as well as on a per-user basis.</p> <p>Here are the details:</p> <h4 id=duplicates>Duplicates<a class=headerlink href=#duplicates title="Permanent link">&para;</a></h4> <p><code>spacesavers2_mimeo</code> uses the following logic to find duplicates:</p> <ul> <li>Bin files by their top (and bottom) xxHashes irrespective of user id (allusers mode)</li> <li>Check if each bin has unique sized files. If a bin has more than 1 size, then it needs to be binned further. Sometimes, xxHash of top and bottom chunks also gives the same combination of hash for differing files. These files will have different sizes. Hence, re-bin them accordingly.</li> <li>If same size, then check inodes. If all files in the same bin have the same inode, then these are just hard-links. But, if there are multiple inodes, then we have <strong>duplicates</strong>!</li> <li>If we have duplicates, then <code>spacesavers2_mimeo</code> keeps track of number of duplicates per bin. Number of duplicates is equal to number of inodes in each bin minus one.</li> <li>If we have duplicates, then the oldest file is identified and considered to be the original file. All other files are marked <em>duplicate</em>, irrespective of user id.</li> <li>duplicate files are reported in gzip format with the following columns for all users and per-user basis</li> </ul> <p>Here is what the <code>.files.gz</code> file columns (space-separated) represent:</p> <table> <thead> <tr> <th>Column</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>top chunk and bottom chunk hashes separated by "#"</td> </tr> <tr> <td>2</td> <td>separator ":"</td> </tr> <tr> <td>3</td> <td>Number of duplicates files (not duplicate inodes)</td> </tr> <tr> <td>4</td> <td>Size of each file</td> </tr> <tr> <td>5</td> <td>List of users duplicates serapated by "##"</td> </tr> </tbody> </table> <blockquote> <p>NOTE: Number of dupicate files can be greater than number of duplicate inodes as each file can have multiple hard links already. Hence, while calculating total duplicate bytes we use (total_number_of_unique_inodes_per_group_of_duplicate_files - 1) X size_of_each_file. The "minus 1" is to not count the size of the original file.</p> </blockquote> <p>Each file in the last column above is ";" separated with the same 13 items as described in the <code>catalog</code> file. The only difference is that the username and groupame are now appended to each file entry.</p> <p>Along with creating one <code>.mimeo.files.gz</code> and <code>.mimeo.summary.txt</code> file per user encountered, <code>spacesavers2_mimeo</code> also generates a <code>allusers.mimeo.files.gz</code> file for all users combined. This file is later used by <code>spacesavers2_blamematrix</code> as input.</p> <h4 id=summaries>Summaries<a class=headerlink href=#summaries title="Permanent link">&para;</a></h4> <p>Summaries, files ending with <code>.mimeo.summary.txt</code> are collected and reported for all users (<code>allusers.mimeo.summary.txt</code>) and per-user (<code>USERNAME.mimeo.summary.txt</code>) basis for user-defined depth (and beyond). The columns (tab-delimited) in the summary file:</p> <table> <thead> <tr> <th>Column</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>absolute path</td> </tr> <tr> <td>2</td> <td>total bytes</td> </tr> <tr> <td>3</td> <td>duplicate bytes</td> </tr> <tr> <td>4</td> <td>percent duplicate bytes</td> </tr> <tr> <td>5</td> <td>total files</td> </tr> <tr> <td>6</td> <td>duplicate files</td> </tr> <tr> <td>7</td> <td>percent duplicate files</td> </tr> <tr> <td>8</td> <td>average file age of all files (days)</td> </tr> <tr> <td>9</td> <td>average file age of duplicates (days)</td> </tr> <tr> <td>10</td> <td>AgeScore</td> </tr> <tr> <td>11</td> <td>DupScore</td> </tr> <tr> <td>12</td> <td>OccScore</td> </tr> <tr> <td>13</td> <td>OverallScore</td> </tr> </tbody> </table> <p>For columns 10 through 13, the same logic is used as <a href=https://ccbr.github.io/spacesavers/usage/df/ >spacesavers</a>.</p> <h4 id=kronatsv-and-kronahtml>KronaTSV and KronaHTML<a class=headerlink href=#kronatsv-and-kronahtml title="Permanent link">&para;</a></h4> <ul> <li>KronaTSV is tab-delimited with first column showing the number of duplicate bytes and every subsequent column giving the folder depths.</li> <li>ktImportText is then used to convert the KronaTSV to KronaHTML which can be shared easily and only needs a HTML5 supporting browser for viewing.</li> </ul> <h4 id=blamematrix>Blamematrix<a class=headerlink href=#blamematrix title="Permanent link">&para;</a></h4> <ul> <li>rows are folders as 1 level deeper than the "mindepth"</li> <li>columns are all individual usernames, plus an "allusers" column</li> <li>only duplicate-bytes are reported</li> </ul> </div> </div><script async src="https://www.googletagmanager.com/gtag/js?id=G-D3SL9V30KL"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D3SL9V30KL'); // Replace with your tracking ID
</script> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span> <a href=https://github.com/CCBR/spacesavers2 class="fa fa-code-fork" style="color: #fcfcfc"> CCBR/spacesavers2</a> </span> <span><a href=../catalog/ style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../grubbers/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../js/jquery-3.6.0.min.js></script> <script>var base_url = "..";</script> <script src=../js/theme_extra.js></script> <script src=../js/theme.js></script> <script src=../js/custom.js></script> <script src=../search/main.js></script> <script src=../js/version-select.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 