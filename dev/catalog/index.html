<!DOCTYPE html><html class=writer-html5 lang=en> <head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content="Vishal Koparde, Ph.D."><link rel="shortcut icon" href=../img/favicon.ico><title>catalog - spacesavers2</title><link rel=stylesheet href=../css/theme.css><link rel=stylesheet href=../css/theme_extra.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css><link href=../css/custom.css rel=stylesheet><link href=../css/version-select.css rel=stylesheet><script>
        // Current page data
        var mkdocs_page_name = "catalog";
        var mkdocs_page_input_path = "catalog.md";
        var mkdocs_page_url = null;
      </script><!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]--><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js></script><script>hljs.highlightAll();</script></head> <body class=wy-body-for-nav role=document> <div class=wy-grid-for-nav> <nav data-toggle=wy-nav-shift class="wy-nav-side stickynav"> <div class=wy-side-scroll> <div class=wy-side-nav-search> <a href=.. class="icon icon-home"> spacesavers2 </a><div role=search> <form id=rtd-search-form class=wy-form action=../search.html method=get> <input type=text name=q placeholder="Search docs" aria-label="Search docs" title="Type search term here"> </form> </div> </div> <div class="wy-menu wy-menu-vertical" data-spy=affix role=navigation aria-label="Navigation menu"> <ul> <li class=toctree-l1><a class="reference internal" href=..>Background</a> </li> </ul> <p class=caption><span class=caption-text>Usage</span></p> <ul class=current> <li class="toctree-l1 current"><a class="reference internal current" href=#>catalog</a> <ul class=current> <li class=toctree-l2><a class="reference internal" href=#inputs>Inputs</a> </li> <li class=toctree-l2><a class="reference internal" href=#output>Output</a> </li> </ul> </li> <li class=toctree-l1><a href=../mimeo/ class="reference internal">mimeo</a> </li> <li class=toctree-l1><a href=../grubbers/ class="reference internal">grubbers</a> </li> <li class=toctree-l1><a href=../usurp/ class="reference internal">usurp</a> </li> <li class=toctree-l1><a href=../e2e/ class="reference internal">e2e</a> </li> <li class=toctree-l1><a href=../pdq/ class="reference internal">pdq</a> </li> <li class=toctree-l1><a href=../pdq_create_db/ class="reference internal">pdq_create_db</a> </li> <li class=toctree-l1><a href=../pdq_update_db/ class="reference internal">pdq_update_db</a> </li> </ul> </div> </div> </nav> <section data-toggle=wy-nav-shift class=wy-nav-content-wrap> <nav class=wy-nav-top role=navigation aria-label="Mobile navigation menu"> <i data-toggle=wy-nav-top class="fa fa-bars"></i> <a href=..>spacesavers2</a> </nav> <div class=wy-nav-content> <div class=rst-content><div role=navigation aria-label="breadcrumbs navigation"> <ul class=wy-breadcrumbs> <li><a href=.. class="icon icon-home" aria-label=Docs></a></li> <li class=breadcrumb-item>Usage</li> <li class="breadcrumb-item active">catalog</li> <li class=wy-breadcrumbs-aside> <a href=https://github.com/CCBR/spacesavers2/edit/main/catalog.md>Edit on CCBR/spacesavers2</a> </li> </ul> <hr> </div> <div role=main class=document itemscope=itemscope itemtype=http://schema.org/Article> <div class=section itemprop=articleBody> <h2 id=spacesavers2_catalog>spacesavers2_catalog<a class=headerlink href=#spacesavers2_catalog title="Permanent link">&para;</a></h2> <p>This uses <code>glob</code> library to list all files in a user-provided folder recursively. </p> <p>For each file it gathers information like: - filesize - check if it is symlink - inode - creation and modificatino time - user id - group id</p> <p>For each file it also computes a unique hash (using xxHash library) for: - top chunk of the file - bottom chunk of the file (<code>-e</code> option)</p> <h3 id=inputs>Inputs<a class=headerlink href=#inputs title="Permanent link">&para;</a></h3> <ul> <li><code>--folder</code>: Path to the folder to run <code>spacesavers2_catalog</code> on.</li> <li><code>--threads</code>: <code>spacesavers2_catalog</code> uses multiprocessing library to parallelize orchestration. This defines the number of threads to run in parallel.</li> <li><code>--buffersize</code>: This defines the size of the top (or bottom) chunk of the file to be used to by xxHash. (default 128 KB)</li> <li><code>--ignoreheadersize</code>: This defines the size of the top of the file to be <strong>ignored</strong> before reading the top chunk for xxHash calculation. This is useful for ignore the header portion of files like BAM or BIGWIG which may have the same top chunk (Eg. samples aligned to the same reference index will generate BAMs with the same header hence original <code>spacesaver</code>, which only looks at the top chunk, may call them duplicates. <code>spacesavers2</code> tries to do a better job at this.). (default 1 MB)</li> <li><code>--se</code>: Comma-separated special extensions for home <code>spacesavers2</code> ignores the headers before extracting the top chunk for xxHash calculation. The default is "bam,bai,bigwig,bw,csi".</li> <li><code>--bottomhash</code>: Default False. Use the bottom chunk along with the top chunk of the file for xxHash calculation.</li> <li><code>--outfile</code>: If not supplied then the optput is written to the screen.</li> <li><code>--brokenlink</code>: Default False. Create a file listing broken symlinks per-user.</li> <li><code>--geezer</code>: Default False. Create a file listing really old files per-user. Output files have 3 columns: age, size, path</li> <li><code>--geezerage</code>: Default 5 * 365. age in days to be considered a geezer file.</li> <li><code>--geezersize</code>: Default 10 MiB. minimum size in bytes of geezer file to be reported.</li> </ul> <blockquote> <p>NOTE: <code>spacesavers2_catalog</code> reports errors (eg. cannot read file) to STDERR</p> </blockquote> <div class=highlight><pre><span></span><code>usage:<span class=w> </span>spacesavers2_catalog<span class=w> </span><span class=o>[</span>-h<span class=o>]</span><span class=w> </span>-f<span class=w> </span>FOLDER<span class=w> </span><span class=o>[</span>-p<span class=w> </span>THREADS<span class=o>]</span><span class=w> </span><span class=o>[</span>-b<span class=w> </span>BUFFERSIZE<span class=o>]</span><span class=w> </span><span class=o>[</span>-i<span class=w> </span>IGNOREHEADERSIZE<span class=o>]</span><span class=w> </span><span class=o>[</span>-x<span class=w> </span>SE<span class=o>]</span><span class=w> </span><span class=o>[</span>-s<span class=w> </span>ST_BLOCK_BYTE_SIZE<span class=o>]</span><span class=w> </span><span class=o>[</span>-o<span class=w> </span>OUTFILE<span class=o>]</span>
<span class=w>                            </span><span class=o>[</span>-e<span class=w> </span><span class=p>|</span><span class=w> </span>--bottomhash<span class=w> </span><span class=p>|</span><span class=w> </span>--no-bottomhash<span class=o>]</span><span class=w> </span><span class=o>[</span>-l<span class=w> </span><span class=p>|</span><span class=w> </span>--brokenlink<span class=w> </span><span class=p>|</span><span class=w> </span>--no-brokenlink<span class=o>]</span><span class=w> </span><span class=o>[</span>-g<span class=w> </span><span class=p>|</span><span class=w> </span>--geezers<span class=w> </span><span class=p>|</span><span class=w> </span>--no-geezers<span class=o>]</span>
<span class=w>                            </span><span class=o>[</span>-a<span class=w> </span>GEEZERAGE<span class=o>]</span><span class=w> </span><span class=o>[</span>-z<span class=w> </span>GEEZERSIZE<span class=o>]</span><span class=w> </span><span class=o>[</span>-v<span class=o>]</span>

spacesavers2_catalog:<span class=w> </span>get<span class=w> </span>per<span class=w> </span>file<span class=w> </span>info.

options:
<span class=w>  </span>-h,<span class=w> </span>--help<span class=w>            </span>show<span class=w> </span>this<span class=w> </span><span class=nb>help</span><span class=w> </span>message<span class=w> </span>and<span class=w> </span><span class=nb>exit</span>
<span class=w>  </span>-f<span class=w> </span>FOLDER,<span class=w> </span>--folder<span class=w> </span>FOLDER
<span class=w>                        </span>spacesavers2_catalog<span class=w> </span>will<span class=w> </span>be<span class=w> </span>run<span class=w> </span>on<span class=w> </span>all<span class=w> </span>files<span class=w> </span><span class=k>in</span><span class=w> </span>this<span class=w> </span>folder<span class=w> </span>and<span class=w> </span>its<span class=w> </span>subfolders
<span class=w>  </span>-p<span class=w> </span>THREADS,<span class=w> </span>--threads<span class=w> </span>THREADS
<span class=w>                        </span>number<span class=w> </span>of<span class=w> </span>threads<span class=w> </span>to<span class=w> </span>be<span class=w> </span>used<span class=w> </span><span class=o>(</span>default<span class=w> </span><span class=m>4</span><span class=o>)</span>
<span class=w>  </span>-b<span class=w> </span>BUFFERSIZE,<span class=w> </span>--buffersize<span class=w> </span>BUFFERSIZE
<span class=w>                        </span>buffersize<span class=w> </span><span class=k>for</span><span class=w> </span>xhash<span class=w> </span>creation<span class=w> </span><span class=o>(</span><span class=nv>default</span><span class=o>=</span><span class=m>128</span><span class=w> </span>*<span class=w> </span><span class=m>1028</span><span class=w> </span>bytes<span class=o>)</span>
<span class=w>  </span>-i<span class=w> </span>IGNOREHEADERSIZE,<span class=w> </span>--ignoreheadersize<span class=w> </span>IGNOREHEADERSIZE
<span class=w>                        </span>this<span class=w> </span>sized<span class=w> </span>header<span class=w> </span>of<span class=w> </span>the<span class=w> </span>file<span class=w> </span>is<span class=w> </span>ignored<span class=w> </span>before<span class=w> </span>extracting<span class=w> </span>buffer<span class=w> </span>of<span class=w> </span>buffersize<span class=w> </span><span class=k>for</span><span class=w> </span>xhash<span class=w> </span>creation<span class=w> </span><span class=o>(</span>only<span class=w> </span><span class=k>for</span><span class=w> </span>special
<span class=w>                        </span>extensions<span class=w> </span>files<span class=o>)</span><span class=w> </span><span class=nv>default</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=m>1024</span><span class=w> </span>*<span class=w> </span><span class=m>1024</span><span class=w> </span>*<span class=w> </span><span class=m>1024</span><span class=w> </span>bytes
<span class=w>  </span>-x<span class=w> </span>SE,<span class=w> </span>--se<span class=w> </span>SE<span class=w>        </span>comma<span class=w> </span>separated<span class=w> </span>list<span class=w> </span>of<span class=w> </span>special<span class=w> </span>extensions<span class=w> </span><span class=o>(</span><span class=nv>default</span><span class=o>=</span>bam,bai,bigwig,bw,csi<span class=o>)</span>
<span class=w>  </span>-s<span class=w> </span>ST_BLOCK_BYTE_SIZE,<span class=w> </span>--st_block_byte_size<span class=w> </span>ST_BLOCK_BYTE_SIZE
<span class=w>                        </span>st_block_byte_size<span class=w> </span>on<span class=w> </span>current<span class=w> </span>filesystem<span class=w> </span><span class=o>(</span>default<span class=w> </span><span class=m>512</span><span class=o>)</span>
<span class=w>  </span>-o<span class=w> </span>OUTFILE,<span class=w> </span>--outfile<span class=w> </span>OUTFILE
<span class=w>                        </span>outfile<span class=w> </span>...<span class=w> </span>catalog<span class=w> </span>file<span class=w> </span>..<span class=w> </span>by<span class=w> </span>default<span class=w> </span>output<span class=w> </span>is<span class=w> </span>printed<span class=w> </span>to<span class=w> </span>screen
<span class=w>  </span>-e,<span class=w> </span>--bottomhash,<span class=w> </span>--no-bottomhash
<span class=w>                        </span>separately<span class=w> </span>calculated<span class=w> </span>second<span class=w> </span><span class=nb>hash</span><span class=w> </span><span class=k>for</span><span class=w> </span>the<span class=w> </span>bottom/end<span class=w> </span>of<span class=w> </span>the<span class=w> </span>file.
<span class=w>  </span>-l,<span class=w> </span>--brokenlink,<span class=w> </span>--no-brokenlink
<span class=w>                        </span>output<span class=w> </span>per-user<span class=w> </span>broken<span class=w> </span>links<span class=w> </span>list.
<span class=w>  </span>-g,<span class=w> </span>--geezers,<span class=w> </span>--no-geezers
<span class=w>                        </span>output<span class=w> </span>per-user<span class=w> </span>geezer<span class=w> </span>files<span class=w> </span>list.
<span class=w>  </span>-a<span class=w> </span>GEEZERAGE,<span class=w> </span>--geezerage<span class=w> </span>GEEZERAGE
<span class=w>                        </span>age<span class=w> </span><span class=k>in</span><span class=w> </span>days<span class=w> </span>to<span class=w> </span>be<span class=w> </span>considered<span class=w> </span>a<span class=w> </span>geezer<span class=w> </span>file<span class=w> </span><span class=o>(</span>default<span class=w> </span>5yrs<span class=w> </span>...<span class=w> </span><span class=m>5</span><span class=w> </span>*<span class=w> </span><span class=m>365</span><span class=o>)</span>.
<span class=w>  </span>-z<span class=w> </span>GEEZERSIZE,<span class=w> </span>--geezersize<span class=w> </span>GEEZERSIZE
<span class=w>                        </span>minimum<span class=w> </span>size<span class=w> </span><span class=k>in</span><span class=w> </span>bytes<span class=w> </span>of<span class=w> </span>geezer<span class=w> </span>file<span class=w> </span>to<span class=w> </span>be<span class=w> </span>reported<span class=w> </span><span class=o>(</span>default<span class=w> </span>10MiB<span class=w> </span>...<span class=w> </span><span class=m>10</span><span class=w> </span>*<span class=w> </span><span class=m>1024</span><span class=w> </span>*<span class=w> </span><span class=m>1024</span><span class=o>)</span>.
<span class=w>  </span>-v,<span class=w> </span>--version<span class=w>         </span>show<span class=w> </span>program<span class=err>&#39;</span>s<span class=w> </span>version<span class=w> </span>number<span class=w> </span>and<span class=w> </span><span class=nb>exit</span>

Version:
<span class=w>    </span>v0.11.4
Example:
<span class=w>    </span>&gt;<span class=w> </span>spacesavers2_catalog<span class=w> </span>-f<span class=w> </span>/path/to/folder<span class=w> </span>-p<span class=w> </span><span class=m>56</span><span class=w> </span>-e<span class=w> </span>-l<span class=w> </span>-g
</code></pre></div> <h3 id=output>Output<a class=headerlink href=#output title="Permanent link">&para;</a></h3> <h2 id=catalog-file>catalog file<a class=headerlink href=#catalog-file title="Permanent link">&para;</a></h2> <p><code>spacesavers2_catalog</code> creates one semi-colon seperated output line per input file. Here is an example line:</p> <p><div class=highlight><pre><span></span><code>%<span class=w> </span>head<span class=w> </span>-n1<span class=w> </span>test.catalog
<span class=s2>&quot;/data/CBLCCBR/kopardevn_tmp/spacesavers2_testing/_data_CCBR_Pipeliner_db_PipeDB_Indices.ls.old&quot;</span><span class=p>;</span>False<span class=p>;</span><span class=m>1653453</span><span class=p>;</span><span class=m>47</span><span class=p>;</span><span class=m>372851499</span><span class=p>;</span><span class=m>1</span><span class=p>;</span><span class=m>1</span><span class=p>;</span><span class=m>5</span><span class=p>;</span><span class=m>5</span><span class=p>;</span><span class=m>37513</span><span class=p>;</span><span class=m>57886</span><span class=p>;</span>4707e661a1f3beca1861b9e0e0177461<span class=p>;</span>52e5038016c3dce5b6cdab635765cc79<span class=p>;</span>
</code></pre></div> The 13 items in the line are as follows:</p> <table> <thead> <tr> <th>Column</th> <th>Description</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>File absolute path</td> <td>"/data/CBLCCBR/kopardevn_tmp/spacesavers2_testing/_data_CCBR_Pipeliner_db_PipeDB_Indices.ls.old"</td> </tr> <tr> <td>2</td> <td>Is file a symlink?</td> <td>FALSE</td> </tr> <tr> <td>3</td> <td>file size in bytes</td> <td>1653453</td> </tr> <tr> <td>4</td> <td>file device</td> <td>47</td> </tr> <tr> <td>5</td> <td>file inode</td> <td>372851499</td> </tr> <tr> <td>6</td> <td>number of hardlinks</td> <td>1</td> </tr> <tr> <td>7</td> <td>access age in days</td> <td>1</td> </tr> <tr> <td>8</td> <td>modification age in days</td> <td>5</td> </tr> <tr> <td>9</td> <td>creation age in days</td> <td>5</td> </tr> <tr> <td>10</td> <td>user id</td> <td>37513</td> </tr> <tr> <td>11</td> <td>group id</td> <td>57886</td> </tr> <tr> <td>12</td> <td>top chunk xxHash</td> <td>4707e661a1f3beca1861b9e0e0177461</td> </tr> <tr> <td>13</td> <td>bottom chunk xxHash</td> <td>52e5038016c3dce5b6cdab635765cc79</td> </tr> </tbody> </table> <blockquote> <p>NOTE: Some files may have ";" or spaces in their name, hence adding quotes around the absolute file path.</p> </blockquote> <h2 id=broken-links-file>broken links file<a class=headerlink href=#broken-links-file title="Permanent link">&para;</a></h2> <ul> <li>simply lists the paths which are symbolic links, but the destination files do not exist anymore!</li> <li>one file per username.</li> </ul> <blockquote> <p>DISCLAIMER: - may contain false-positives if the user running <code>spacesavers2_catalog</code> does not have read access to the symlinks destination</p> </blockquote> <h2 id=geezer-file>geezer file<a class=headerlink href=#geezer-file title="Permanent link">&para;</a></h2> <ul> <li>lists really old files (default &gt; 5 years).</li> <li>list has 3 columns: age, size and path.</li> <li>one file per username.</li> </ul> </div> </div><script async src="https://www.googletagmanager.com/gtag/js?id=G-D3SL9V30KL"></script> <script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D3SL9V30KL'); // Replace with your tracking ID
</script> </div> </div> </section> </div> <div class=rst-versions role=note aria-label=Versions> <span class=rst-current-version data-toggle=rst-current-version> <span> <a href=https://github.com/CCBR/spacesavers2 class="fa fa-code-fork" style="color: #fcfcfc"> CCBR/spacesavers2</a> </span> <span><a href=.. style="color: #fcfcfc">&laquo; Previous</a></span> <span><a href=../mimeo/ style="color: #fcfcfc">Next &raquo;</a></span> </span> </div> <script src=../js/jquery-3.6.0.min.js></script> <script>var base_url = "..";</script> <script src=../js/theme_extra.js></script> <script src=../js/theme.js></script> <script src=../js/custom.js></script> <script src=../search/main.js></script> <script src=../js/version-select.js></script> <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script> </body> </html> 